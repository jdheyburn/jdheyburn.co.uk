---
date: 2019-11-13
title: "Who Goes Blogging Pt. 2: Custom Domain"
description: Make your portfolio site professional by applying a custom domain to it
tags:
  - architecture
  - cdn
  - cloudflare
  - portfolio-site
  - github-pages
draft: true
---

In the [previous post](/posts/who-goes-blogging-1-getting-started/), we got ourselves up and running with a website generated by Hugo, deployed to GitHub, and hosted by GitHub Pages.

Now, we're going to add a custom domain to our website so that we hide the `<username>.github.io` domain that GitHub Pages is kindly hosting for us for free. 

At the same time, we're going to make our website blazingly fast for users by adding a caching layer with a content distribution network (CDN). 

Lastly, I'm going to throw in a bonus guide on how to redirect from multiple top-level domains (TLDs) to one (e.g. `<your-domain>.com` redirects to `<your-domain>.co.uk`).

# Pre-requisites

There's not much more to add from the last post. I talk a lot about domains and domain name system (DNS), which is the address-finder of the Internet, and an entirely huge beast in its own right. 

Again - I won't try to replicate already great guides out there on the topic. So if you'd like to find out more, see below for some helpful guides.

- https://www.digitalocean.com/community/tutorials/an-introduction-to-dns-terminology-components-and-concepts
- https://opensource.com/article/17/4/introduction-domain-name-system-dns

# Applying a Custom Domain to GitHub Pages
Let's add a degree of professionalism to our site by having a custom domain apply to it. You'll need to make sure you own a domain first before you go ahead, so have a look at a few providers and see which works best for you [from a comparison list](https://www.techradar.com/uk/news/best-domain-registrars-in-2019). I bought mine from [namecheap](https://www.namecheap.com/) just because of the price and WhoisGuard features. There may be other providers that have the same features, so make sure to make your own comparison!

GitHub has a [series of documentation](https://help.github.com/en/github/working-with-github-pages/configuring-a-custom-domain-for-your-github-pages-site) on this in much greater detail than what I am about to write out, should you wish to find out more information.

> In the case of `.co.uk` domains, because it is a UK domain that resides in the EU (for now), the WhoIS lookup is disabled by default - which is a huge win for privacy. WhoisGuard is available for non-EU domains and I highly recommend it.

# Acquire a Domain

The rest of the post will depict a lot of Namecheap semantics, since that is the registrar I have access to. You can choose to follow the guide alongside a different registrar if you wish, at a high-level they will be pretty similar. For now, let's move on ahead with Namecheap...

{{< figure src="/images/namecheap-domain-purchase.png" caption="The hardest part is deciding on the domain name..." alt="Screenshot depicting the namecheap domain purchase page" >}}

Once you've set up an account and purchased your domain, your domain landing page will look something like the below.

{{< figure src="/images/namecheap-domain-acquired.png" caption="Make sure you have auto-renew selected, otherwise you can kiss that domain goodbye when it expires!" alt="Screenshot depicting the namecheap domain landing page" >}}

When you purchase a domain from Namecheap, by default it will be pointing to their own domain name service (DNS) nameservers, as you can see from the picture above. 

This means when we type in our new domain into a browser, it will contact Namecheap for the IP address for that record. 

Currently Namecheap is none the wiser about these records, which isn't very exciting. Let's move on to adding the CDN for the website.

# Adding Our CDN Layer

As discussed in a [previous post](/posts/who-goes-blogging-0-applying-cartography/#supercharge-your-delivery), a CDN can provide us with many benefits. Go check out the page for a refresher of what those are and for why I selected Cloudflare. You can use whichever you like, however the remainder of this guide will focus on Cloudflare in particular. 

## Cloudflare our Domain

Create an account with [Cloudflare](https://www.cloudflare.com/) if you haven't done so already. Once done you'll need to click **Add Site** at the top of the browser dashboard. Enter your newly purchased domain from the previous section.

{{< figure src="/images/cloudflare-add-domain.png" caption="Enter your newly purchased domain from the previous section" alt="Screenshot depicting the Cloudflare add domain page" >}}

Go ahead now and select the free plan, if you want to [go more advanced](https://www.cloudflare.com/en-gb/plans/) then you can do so. 

Once that's created you'll see Cloudflare scan the DNS records for this domain you've added - for now let's navigate back to the [Cloudflare Dashboard](https://dash.cloudflare.com/) and selecting the domain. You'll be presented with a page similar to below, minus all the activity!

{{< figure src="/images/cloudflare-domain-landing.png" caption="Name me a more iconic duo than numbers and graphs. I'll wait..." alt="Screenshot depicting the Cloudflare domain home page" >}}

## Update Cloudflare DNS Records

In order for Cloudflare to provide its benefits, it acts as the DNS server for your domain. This means that it will forward requests of our website to the IP addresses where our website is being hosted. It's place in the topology is like this:

```
1. Domain registrar ---> 2. DNS server and CDN provider ---> 3. Web server location
```

Translated to our architecture:
```
1. Namecheap ---> 2. Cloudflare ---> 3. GitHub Pages
```

What we need to do is instruct Cloudflare where to direct clients of the website. There are several ways of doing this, whether you want your website to be available at `www.<your-domain>.co.uk` (CNAME record), or `<your-domain>.co.uk` (ALIAS (A) record). Both of which are [well documented by GitHub](https://help.github.com/en/github/working-with-github-pages/managing-a-custom-domain-for-your-github-pages-site) already. For the purpose of this post, I'll guide you on my set up which is an ALIAS record.

Back to Cloudflare, you'll need to load up the dashboard for your domain and navigate to the DNS icon in the taskbar at the top. Clicking on **Add record** will allow you to add the A records that point to GitHub Pages's IP addresses. As of writing (and [documented](https://help.github.com/en/github/working-with-github-pages/managing-a-custom-domain-for-your-github-pages-site#configuring-an-apex-domain)) they are:

```
185.199.108.153
185.199.109.153
185.199.110.153
185.199.111.153
```

Let's add these to the Cloudflare DNS page below.

{{< figure src="/images/cloudflare-dns-record.png" caption="Add in the GitHub IP addresses one by one" alt="Screenshot depicting adding DNS records to Cloudflare" >}}

Once done - your records will look something like this:

{{< figure src="/images/cloudflare-completed-records.png" caption="" alt="Screenshot depicting completed DNS management" >}}

You'll notice an additional CNAME record at the bottom for `www`. This will redirect any requests made to `www.jdheyburn.co.uk` to `jdheyburn.co.uk`. This could be something you'd want to replicate too if you wish.

One thing to note down before we move on is to capture the Cloudflare DNS Nameservers that have been assigned to our domain. You can find these on the same DNS management page we are on, but by just scrolling down we can see these nameservers.

{{< figure src="/images/cloudflare-nameservers.png" caption="Make a note of these nameservers for your domain" alt="Screenshot depicting completed Cloudflare DNS nameservers" >}}

## Direct Namecheap to Cloudflare

[Earlier in this post](/posts/who-goes-blogging-2-custom-domain/#acquire-a-domain), I mentioned that a newly created Namecheap domain will default to their own DNS nameservers. We want to change this to Cloudflares DNS nameservers from which we configured our DNS records.

Navigate to the [Namecheap management page](https://ap.www.namecheap.com/domains/list/) for your domain and enter the Cloudflare nameservers once you have selected **Custom DNS**.

<center>{{< figure src="/images/namecheap-nameservers.png" caption="Make a note of these nameservers for your domain" alt="Screenshot depicting completed Cloudflare DNS nameservers" >}}</center>

// TODO finish from here - should be focused on GitHub Pages

Once you've purchased your domain we'll need to create a file in our `blog-source` repo called `CNAME` and populate it with the domain we purchased. In my case, mine looks like this:

{{< highlight bash >}}
# CNAME
jdheyburn.co.uk
{{< / highlight >}}

You might have noticed in the previous section in our `deploy.sh` script it made a reference to this CNAME file. This tells GitHub Pages to redirect any calls made to the `.github.io` domain to our custom one. This is why we added line 9 in the script, so that it winds up in the rendered repo.

With our custom domain created, we need to tell the registrar to point to the DNS servers where our site is being hosted from. GitHub has [this documented well too](https://help.github.com/en/github/working-with-github-pages/managing-a-custom-domain-for-your-github-pages-site#configuring-an-apex-domain), so you can see the latest IP addresses from there. You will need to consult your registrar on how set this. If you followed my footsteps to set this up using namecheap, search on [this page](https://www.namecheap.com/support/knowledgebase/article.aspx/767/10/how-to-change-dns-for-a-domain) for **Custom DNS** on how to change it.

Once we've made the change, it may take a while for the update to reflect across the DNS ecosystem. Once propagated, your website should be accessible at your domain!

# CDN-all-the-things

Now for the final piece of the puzzle, adding in a CDN layer. I briefly spoke about the benefits in [part 0](/posts/applying-cartography/), but [here](https://blog.webnames.ca/advantages-and-disadvantages-of-a-content-delivery-network/) is a good resource if you'd like to do more reading.

> Like with any introduction of an architectural component, a CDN has some drawbacks, such as making your service now dependent on a third party for which you have no control over. Namely CloudFlare in particular has had some high profile outages of recent date, but has been extremely reliable in my previous experiences with them.

>Given this information I believe you can make your own mind up on what is best for yourself. For me, I the benefits far outweigh the downsides.

For this website I am using CloudFlare as the CDN, given it is free and the one I have most experience with. 

# Bonus: Adding more top-level domains for redirection
